# Fusion Chaos - 2.5 Debug System

## 2.5 调试系统 (Debug System)

调试系统旨在为开发者提供一个实时的参数调整界面，以便在不重新编译的情况下快速迭代游戏手感和数值平衡。

### 1. 调试面板设计 (Debug Panel Design)

调试面板作为一个 Flutter Overlay 实现，悬浮在游戏层之上，确保其交互不会直接干扰游戏的输入逻辑。

- **位置**: 屏幕右上角。
- **状态**: 可折叠/展开。默认显示 "Show Debug" 按钮，展开后显示详细配置项。
- **集成方式**: 通过 `GameWidget` 的 `overlayBuilderMap` 进行注册。

### 2. 当前功能 (Current Features)

目前调试面板用于调整 **磁吸、生成与镜头** 的核心参数：

| 参数名称 | 代码对应变量 | 取值范围 | 说明 |
| :--- | :--- | :--- | :--- |
| **吸附半径** | `player.attractionRadius` | 0 - 500 | 定义引力场的覆盖半径，影响方块开始被吸引的远近。 |
| **控制圈半径** | `player.controlRadius` | 与吸附半径同步 | 当前实现中与 `attractionRadius` 保持一致，用于可视控制环、角度对齐与失败判定。 |
| **吸附力度** | `player.attractionForce` | 0 - 2000 | 定义引力的基础强度，影响方块向网格位移动的速度。 |
| **批处理大小** | `player.magnetBatchSize` | 1 - 100 | 每帧处理的待吸附方块数量，用于平衡性能与响应速度。 |
| **刷新间隔** | `player.candidateRefreshInterval` | 0.01 - 1.0 | 重新扫描场景中待吸附方块的时间间隔（秒）。 |
| **游离漂移速度** | `game.freeDriftSpeed` | 0 - 100 | 控制未连接方块以恒定速度朝玩家核心移动的快慢。 |
| **每次生成数量** | `game.spawnCountPerTick` | 1 - 20 | 每个生成周期产生的自由方块数量。 |
| **生成间隔** | `game.spawnIntervalSeconds` | 0.2 - 5.0 | 定时生成的周期（秒）。 |
| **立即生成** | `game.spawnNow()` | 按钮触发 | 用于快速验证生成与磁吸表现。 |
| **自动缩放** | `game.enableAutoZoom` | bool | 是否启用基于玩家质量的动态镜头缩放。 |
| **缩放灵敏度** | `game.zoomSensitivity` | 0.0 - 1.0 | 控制缩放随集群大小变化的剧烈程度（默认 0.15）。 |
| **最小缩放** | `game.minZoom` | 0.05 - 0.5 | 镜头拉到最远时的缩放比例限制。 |
| **缩放过渡速度** | `game.zoomSpeed` | 0.5 - 10.0 | 镜头追随质量变化时的平滑过渡速度。 |

### 3. 实现细节 (Implementation Details)

- **动态参数**: 将 `Player` 类中的相关参数从静态常量改为实例变量，允许运行时修改。
- **分组管理**: 调试面板支持二级折叠（如 "Magnetism Settings"），便于管理后续增加的调试分类。
- **默认折叠行为**: Visual Effects 分组默认折叠，减少调试面板初始展开噪音。
- **实时更新**: 调试面板中的 `Slider` 组件在 `onChanged` 回调中通过 `setState` 直接修改 `game.player` 的对应属性。由于 `Player` 的 `update` 循环每帧都在读取这些值，修改会立即生效。
- **代码结构**:
    - UI 组件: `lib/ui/debug_panel.dart`
    - 注册入口: `lib/main.dart`

### 4. 未来扩展 (Future Extensions)

随着更多功能的加入，调试系统预计将包含：
- **性能监控**: FPS、实体数量统计。
- **生成控制扩展**: 生成位置策略、波次模板、生成上限等更细粒度控制。
- **视觉调试**: 开关碰撞框显示、磁力线可视化等。
- **存档测试**: 快速增加/减少玩家质量。
